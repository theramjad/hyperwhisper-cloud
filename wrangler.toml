name = "hyperwhisper-v1"
main = "src/index.ts"
compatibility_date = "2024-09-23"
compatibility_flags = ["nodejs_compat_v2"]

[placement]
mode = "smart"

# Development environment
[env.development]
name = "hyperwhisper-v1-dev"

[env.development.vars]
ENVIRONMENT = "development"
GROQ_BASE_URL = "https://api.groq.com/openai/v1"
# License/Credits API - points to Next.js backend
# HYPERWHISPER_API_URL set in secrets (e.g., "https://hyperwhisper.com" or localhost for dev)
# HYPERWHISPER_API_KEY set in secrets

# Development KV namespaces (v1)
[[env.development.kv_namespaces]]
binding = "RATE_LIMITER"
id = "aff5289c5d1342a59bcc7535a350afc9"

[[env.development.kv_namespaces]]
binding = "DEVICE_CREDITS"
id = "88623c47392f43d183b5f041fa1566ba"

[[env.development.kv_namespaces]]
binding = "LICENSE_CACHE"
id = "6e863d08932c45bc9063e60cdf1f5015"

# Development R2 bucket for temporary audio storage (large file transcription)
[[env.development.r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "hyperwhisper-audio-temp-dev"

# Development custom domain
[[env.development.routes]]
pattern = "transcribe-dev-v1.hyperwhisper.com"
custom_domain = true

[env.development.observability]
enabled = true
head_sampling_rate = 1.0

# Production environment
[env.production]
name = "hyperwhisper-v1-prod"

[env.production.vars]
ENVIRONMENT = "production"
GROQ_BASE_URL = "https://api.groq.com/openai/v1"
# License/Credits API - points to Next.js backend
# HYPERWHISPER_API_URL set in secrets (https://hyperwhisper.com)
# HYPERWHISPER_API_KEY set in secrets

# Production KV namespaces (v1)
[[env.production.kv_namespaces]]
binding = "RATE_LIMITER"
id = "7e39597efebe49d59fd49cead5361f8d"

[[env.production.kv_namespaces]]
binding = "DEVICE_CREDITS"
id = "36019fbb98194feda455b1c39e47e492"

[[env.production.kv_namespaces]]
binding = "LICENSE_CACHE"
id = "c24a0bf339dd415ba3f669e81923e310"

# Production R2 bucket for temporary audio storage (large file transcription)
[[env.production.r2_buckets]]
binding = "AUDIO_BUCKET"
bucket_name = "hyperwhisper-audio-temp-prod"

# Production custom domain
[[env.production.routes]]
pattern = "transcribe-prod-v1.hyperwhisper.com"
custom_domain = true

[env.production.observability]
enabled = true
head_sampling_rate = 1.0
